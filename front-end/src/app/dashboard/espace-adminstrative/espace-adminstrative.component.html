<div class="dashboard-container" fxLayout="column" fxLayoutGap="32px">

  <!-- 1ère ligne : Réunions & Notes -->
  <div fxLayout="row" fxLayoutGap="16px" fxLayout.xs="column">
    <!-- Réunions -->
    <section class="section meetings" fxFlex="50" fxLayout="column" fxLayoutGap="16px">
      <div fxLayout="row" fxLayoutAlign="space-between center">
        <h2>Mes réunions</h2>
        <button
          mat-raised-button
          color="primary"
          class="enhanced-meeting-button"
          (click)="openAddMeetingDialog()"
        >
          <mat-icon class="icon-left">event</mat-icon>
          Ajouter une réunion
        </button>



      </div>

      <div class="content-box" fxLayout="column" fxLayoutGap="16px">
        <div class="meeting-card" *ngFor="let m of meetings">
          <h4>{{ m.subject }}</h4>
          <p>
            <strong>Date :</strong>
            {{ m.date | date:'mediumDate' }} à {{ m.date | date:'shortTime' }}
          </p>
          <p><strong>Description :</strong> {{ m.description }}</p>
          <p *ngIf="m.project"><strong>Projet :</strong> {{ m.project.name }}</p>

          <div fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="8px">
            <button mat-button class="simple-button mat-accent" color="accent" (click)="openMeetingDetails(m)">Détails</button>
            <button *ngIf="m.project" mat-button class="simple-button mat-primary" color="primary" (click)="rootToProject(m.project.id)">Aller au projet</button>
          </div>
</div>

        <p *ngIf="!meetings.length" class="empty">Aucune réunion planifiée.</p>
      </div>
    </section>

    <!-- Notes & Décisions -->
    <section
      class="section notes-decisions"
      *ngIf="isSuperviser()"
      fxFlex="50"
      fxLayout="column"
      fxLayoutGap="16px"
    >
      <div fxLayout="row" fxLayoutAlign="space-between center">
        <h2>Notes &amp; Décisions</h2>
        <button
          mat-flat-button
          color="accent"
          class="enhanced-meeting-button"
          (click)="openNoteDialog()"
        >
          <mat-icon class="icon-left">note_add</mat-icon>
          Nouvelle note / décision
        </button>

      </div>
      <div class="content-box" fxLayout="column" fxLayoutGap="12px">
        <div
          class="note-card"
          *ngFor="let note of notes"
          (click)="viewNoteDetail(note.id)"
        >
          <h3 class="note-title">{{ note.titre }}</h3>
          <div class="note-meta">
            <span class="note-statut approved">{{ note.statut }}</span>
            <span class="note-type">{{ note.typeNote }}</span>
            <span class="note-date">{{ note.dateCreation | date:'d MMM y':'':'fr' }}</span>
          </div>
        </div>
        <p *ngIf="!notes.length" class="empty">Aucune note ou décision.</p>
      </div>
    </section>
  </div>

  <!-- 2ème ligne : Réclamations & Demandes de suspension -->
  <div fxLayout="row" fxLayoutGap="16px" fxLayout.xs="column">
    <!-- Réclamations -->
    <section
      class="section complaints"
      *ngIf="isSuperviser()"
      fxFlex="50"
      fxLayout="column"
      fxLayoutGap="16px"
    >
      <h2>Réclamations</h2>
      <div class="content-box" fxLayout="column" fxLayoutGap="16px">
  <div
    class="complaint-card"
    *ngFor="let complaint of complaints"
    (click)="openDetails(complaint)"
  >
    <h3>Projet: {{ complaint.project.name }}</h3>
    <p><strong>Raison :</strong> {{ complaint.reason }}</p>

    <small *ngIf="getUser(complaint.complainerId) as u">
      Soumis par le {{ u.role?.libelle }} 
      #{{ u.nom }} {{ u.prenom }}
    </small>

    <!-- Bouton "Marquer comme lu" visible tant que superviserId != currentUserId -->
    <button
      mat-mini-fab
      color="primary"
      *ngIf="complaint.superviserId !== currentUserId"
      (click)="markAsRead(complaint); $event.stopPropagation()"
      matTooltip="Marquer comme lu"
    >
      <mat-icon>done</mat-icon>
    </button>
  </div>

  <p *ngIf="!complaints.length" class="empty">
    Aucune réclamation non traitée pour vous.
  </p>
</div>

    </section>

    <!-- Demandes de suspension -->
    <section
      class="section pause-requests"
      *ngIf="isSuperviser()"
      fxFlex="50"
      fxLayout="column"
      fxLayoutGap="16px"
    >
      <h2>Demandes de suspension</h2>
      <div class="content-box" fxLayout="column" fxLayoutGap="16px">
        <div
          class="request-card"
          *ngFor="let req of pauseRequests"
          (click)="rootToProject(req.projectId)"
        >
          <p><strong>Projet :</strong> {{ req.project.name }}</p>
          <p><strong>Raison :</strong> {{ req.reason }}</p>
          <span
            class="status"
            [ngClass]="{
              approved: req.status === 'APPROVED',
              rejected: req.status === 'REJECTED',
              pending: req.status === 'PENDING'
            }"
          >
            {{ req.status }}
          </span>
        </div>
        <p *ngIf="!pauseRequests.length" class="empty">Aucune demande.</p>
      </div>
    </section>
  </div>

  <!-- 3ème ligne : Calendrier full width -->
  <div fxLayout="row">
    <section class="section calendar" fxFlex="100" fxLayout="column">
      <h2>Calendrier</h2>
      <mbsc-datepicker
        [controls]="['calendar']"
        display="inline"
        [colors]="coloredDays"
        [labels]="labelDays"
        (onDayChange)="onDayChange($event)"
      ></mbsc-datepicker>
    </section>
  </div>

</div>
