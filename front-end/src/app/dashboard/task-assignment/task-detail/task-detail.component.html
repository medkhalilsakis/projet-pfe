<!-- src/app/task-detail/task-detail.component.html -->

<main fxLayout="column" fxLayoutGap="24px" fxFill class="detail-page">

  <!-- Spinner -->
  <div *ngIf="!task" fxFlex fxLayout="row" fxLayoutAlign="center center" class="loading">
    <span class="loading-text">Chargement…</span>
  </div>

  <!-- Contenu -->
  <div *ngIf="task" fxLayout="column" fxLayoutGap="24px">

    <!-- Bouton ZIP & Actions -->
    <div fxLayout="row" fxLayoutAlign="space-between center">
      
      <!-- Tout télécharger -->
      <button mat-raised-button class="mat-stroked-button" color="accent" (click)="downloadAll()">
        <mat-icon>archive</mat-icon>
        Exporter tous les détails de la tâche (ZIP)
      </button>

      <!-- Éditer la tâche -->
      <button *ngIf="isSupervisor()" mat-icon-button class="mat-stroked-button" (click)="editTask()">
        <mat-icon>edit</mat-icon>
      </button>
    </div>

    <!-- Titre + Projet lié -->
    <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="16px">
      <h1 class="task-title">{{ task.name }}</h1>
      <ng-container *ngIf="projectName">
        <button mat-stroked-button class="mat-stroked-button" (click)="goToProject()">
          Voir le projet : {{ projectName }}
        </button>
      </ng-container>
    </div>

    <!-- Métadonnées -->
    <section fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="16px" class="meta">
      <span class="status-badge">{{ getStatusLabel(task.status) }}</span>
      <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="4px" class="meta-item">
        <mat-icon>calendar_today</mat-icon>
        <span>Deadline : {{ task.deadline | date:'fullDate' }}</span>
      </div>
      <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="4px" class="meta-item">
        <mat-icon>publish</mat-icon>
        <span>Publiée : {{ task.publishedAt | date:'fullDate' }}</span>
      </div>
    </section>

    <!-- Description & Outils -->
    <section fxLayout="column" fxLayoutGap="24px">
      <div class="description" fxFlex>
        <h2>Description</h2>
        <p>{{ task.description }}</p>
      </div>

      <!-- n’affiche que s’il y a des outils -->
      <div *ngIf="getOutilsList().length" class="tools-section" fxFlex>
        <h2>Outils & Technologies</h2>
        <div fxLayout="row wrap" fxLayoutGap="8px" class="badges">
          <span class="badge" *ngFor="let o of getOutilsList()">{{ o }}</span>
        </div>
      </div>
    </section>

    <!-- Assigné à (si non vide) -->
    <section *ngIf="task.assignedTo?.length">
      <h2>Assigné à</h2>
      <div fxLayout="row wrap" fxLayoutGap="12px" class="assignees">
        <div *ngFor="let u of task.assignedTo" class="custom-chip">
          {{ u.prenom }} {{ u.nom }}
        </div>
      </div>
    </section>

    <!-- Cahier des charges (PDF) -->
    <section *ngIf="pdfAttachments.length" fxLayout="column" fxLayoutGap="16px">
      <h2>Cahier des charges (PDF)</h2>
      <div *ngFor="let pdf of pdfAttachments" class="pdf-section">
        <ngx-extended-pdf-viewer
          [src]="API + '/taches/attachments/' + pdf.id"
          useBrowserLocale="true"
          [minifiedJSLibraries]="false"
          height="600px"
          [showSidebarButton]="true"
          style="width: 100%;">
        </ngx-extended-pdf-viewer>
      </div>
    </section>

  
    <!-- Images -->
<section *ngIf="imageAttachments.length">
  <h2>Images</h2>
  <div class="image-grid">
    <img *ngFor="let img of imageAttachments"
         [src]="API + '/taches/attachments/' + img.id"
         [alt]="img.fileName"
         class="preview-image">
  </div>
</section>

<!-- Vidéos -->
<section *ngIf="videoAttachments.length">
  <h2>Vidéos</h2>
  <div class="video-grid">
    <video *ngFor="let vid of videoAttachments"
           controls
           [src]="API + '/taches/attachments/' + vid.id"
           class="video-player">
    </video>
  </div>
</section>

<!-- Autres fichiers -->
<section *ngIf="otherAttachments.length">
  <h2>Autres fichiers</h2>
  <div class="other-grid">
    <a *ngFor="let a of otherAttachments"
       [href]="API + '/taches/attachments/' + a.id"
       download
       class="other-file-card">
      <mat-icon>insert_drive_file</mat-icon>
      <span>{{ a.fileName }}</span>
    </a>
  </div>
</section>


  </div>
</main>
