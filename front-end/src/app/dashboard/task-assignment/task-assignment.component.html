<!-- src/app/task-assignment/task-assignment.component.html -->
<mat-toolbar color="primary" class="top-bar">
  <span class="title">Gérer les tâches</span>
  <span class="spacer"></span>
  <button mat-flat-button color="accent" (click)="openNew()">
    <mat-icon>add</mat-icon>
    Nouvelle tâche
  </button>
</mat-toolbar>

<div class="controls">
  <mat-form-field appearance="outline" class="ctrl">
    <mat-label>Recherche</mat-label>
    <input matInput [(ngModel)]="search" (ngModelChange)="onSearchChange()" placeholder="Nom, assigné à…">
    <button matSuffix mat-icon-button *ngIf="search" (click)="search=''; onSearchChange()">
      <mat-icon>close</mat-icon>
    </button>
  </mat-form-field>

  <mat-form-field appearance="outline" class="ctrl status">
    <mat-label>Statut</mat-label>
    <mat-select [(value)]="statusFilter" (selectionChange)="onStatusChange()">
      <mat-option *ngFor="let s of statuses" [value]="s.value">{{ s.label }}</mat-option>
    </mat-select>
  </mat-form-field>
</div>

<div class="grid">
  <ng-container *ngIf="pageSlice.length; else noTasks">
    <div class="task-grid">
      <mat-card *ngFor="let t of pageSlice" class="task-card mat-elevation-z3" ripple (click)="selectTask(t)">
        <mat-card-header>
          <mat-card-title>{{ t.name }}</mat-card-title>
          <mat-card-subtitle>{{ getAssignedNames(t) }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <div class="info">
            <mat-icon>flag</mat-icon>
            <mat-chip>{{ getStatusLabel(t.status) }}</mat-chip>
          </div>
          <div class="info">
            <mat-icon>calendar_today</mat-icon>
            <span>Deadline: {{ t.deadline | date:'shortDate' }}</span>
          </div>
          <div class="info">
            <mat-icon>publish</mat-icon>
            <span>Publiée: {{ t.publishedAt | date:'short' }}</span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </ng-container>

  <ng-template #noTasks>
    <div class="no-tasks">
      <mat-icon>hourglass_empty</mat-icon>
      <p>Aucune tâche trouvée.</p>
    </div>
  </ng-template>
</div>

<mat-paginator
  [length]="filtered.length"
  [pageSize]="pageSize"
  [pageSizeOptions]="[9, 12, 15]"
  (page)="onPageChange($event)"
  showFirstLastButtons>
</mat-paginator>
