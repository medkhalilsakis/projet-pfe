<div class="dashboard-container">
  <mat-card class="upload-card">
    <mat-card-header>
      <mat-card-title>Upload de Projet</mat-card-title>
    </mat-card-header>
  
    <mat-card-content>
      <mat-card-title>
        {{ task ? 'Upload Project for Task: ' + task.name : 'Upload New Project' }}
      </mat-card-title>
      <div class="drop-zone" 
           (drop)="onDrop($event)"
           (dragover)="$event.preventDefault()"
           (dragleave)="$event.preventDefault()"
           [class.dragover]="false">
        <mat-icon>cloud_upload</mat-icon>
        <p>Glissez vos fichiers ici ou</p>
        <input type="file" #fileInput hidden (change)="onFileSelected($event)" multiple webkitdirectory>
        <button mat-raised-button color="primary" (click)="fileInput.click()">
          Sélectionner des fichiers/dossiers
        </button>
        <p>Formats supportés : fichiers/dossiers ou archives (.zip, .rar)</p>
      </div>
  
      <!-- Liste des fichiers en file d'upload -->
      <div class="file-list" *ngIf="files.length > 0">
        <h3>Fichiers sélectionnés :</h3>
        <div class="file-item" *ngFor="let file of files">
          <mat-icon>{{ file.type.includes('directory') ? 'folder' : 'insert_drive_file' }}</mat-icon>
          <span>{{ file.name }}</span>
          <span class="file-size">{{ file.size | fileSize }}</span>
        </div>
      </div>
  
      <div class="progress-section" *ngIf="isUploading">
        <h3>File d'upload :</h3>
        <div class="upload-queue">
          <div class="queue-item" *ngFor="let progress of uploadProgress; let i = index">
            <div class="file-info">
              <mat-icon>{{ getFileIcon(files[i].name) }}</mat-icon>
              <span class="file-name">{{ progress.name }}</span>
            </div>
            
            <div class="progress-container">
              <mat-progress-bar 
                mode="determinate" 
                [value]="progress.progress"
                [color]="progress.progress === 100 ? 'primary' : 'accent'">
              </mat-progress-bar>
              
              <div class="progress-details">
                <span class="speed">{{ progress.speed | number:'1.1-1' }} KB/s</span>
                <span class="percentage">{{ progress.progress }}%</span>
                <span class="size">{{ progress.uploaded | fileSize }} / {{ progress.size | fileSize }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
  
      <div class="action-buttons">
        <button mat-raised-button color="primary" (click)="startUpload()"
                [disabled]="files.length === 0 || isUploading">
          Démarrer l'Upload
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
