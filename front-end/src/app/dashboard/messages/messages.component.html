<div class="messagerie-container">
  <!-- Colonne de recherche et liste des conversations -->
  <div class="conversations-list">
    <mat-form-field appearance="outline" class="search-bar">
      <mat-label>Rechercher un utilisateur</mat-label>
      <input matInput [(ngModel)]="searchQuery" (keyup.enter)="searchUsers()">
      <button mat-icon-button matSuffix (click)="searchUsers()">
        <mat-icon>search</mat-icon>
      </button>
    </mat-form-field>

    <!-- Liste des utilisateurs trouvés pour démarrer une conversation -->
    <mat-nav-list *ngIf="users.length > 0">
      <a mat-list-item *ngFor="let user of users" (click)="startConversation(user)">
        <mat-icon>person</mat-icon>
        <span>{{ user.nom }}</span>
      </a>
    </mat-nav-list>

    <!-- Liste des conversations existantes -->
    <mat-nav-list *ngIf="conversations.length > 0">
      <a mat-list-item *ngFor="let conv of conversations" 
         (click)="selectConversation(conv)" 
         [class.selected]="selectedConversation?.id === conv.id">
        <mat-icon>chat</mat-icon>
        <span>Conversation {{ conv.id }}</span>
        <span class="last-message">{{ conv.lastMessage }}</span>
      </a>
    </mat-nav-list>
  </div>

  <!-- Fenêtre de chat -->
  <div class="chat-window" *ngIf="selectedConversation">
    <div class="chat-header">
      <h3>Conversation {{ selectedConversation.id }}</h3>
    </div>
    <div class="chat-messages">
      <div *ngFor="let msg of messages" class="message" [class.sent]="msg.senderId === user.id">
        <p>{{ msg.content }}</p>
        <span class="timestamp">{{ msg.createdAt | date:'shortTime' }}</span>
      </div>
    </div>
    <div class="chat-input">
      <mat-form-field appearance="outline" class="message-input">
        <input matInput placeholder="Tapez votre message" [(ngModel)]="newMessage">
      </mat-form-field>
      <button mat-icon-button color="primary" (click)="sendMessage()">
        <mat-icon>send</mat-icon>
      </button>
    </div>
  </div>

  <!-- Message d'invite si aucune conversation sélectionnée -->
  <div *ngIf="!selectedConversation && conversations.length === 0" class="no-conversation">
    <p>Aucune conversation en cours. Recherchez un utilisateur pour démarrer un chat.</p>
  </div>
</div>
