<!-- src/app/dashboard/dashboard.component.html -->
<div class="dashboard-container" fxLayout="column" fxLayoutAlign="start stretch">

  <!-- Barre supérieure -->
  <mat-toolbar
    color="primary"
    class="top-toolbar"
    fxLayout="row"
    fxLayoutAlign="start center"
    fxFlex="none"
  >
    <!-- Bouton pour plier/déplier la sidebar -->
    <button mat-icon-button (click)="toggleSideNav()" class="toggle-btn">
      <mat-icon>{{ sideNavOpen() ? 'chevron_left' : 'menu' }}</mat-icon>
    </button>

    <span class="app-name">Projexia</span>

    <div class="toolbar-search" fxFlex="30">
      <input matInput placeholder="Rechercher…" fxFlex>
    </div>

    <div class="toolbar-actions" fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="12px">
      <!-- Notifications -->
      <span
        class="action-icon"
        matBadge="{{ notifications().length }}"
        matBadgeColor="warn"
        matBadgeOverlap="false"
        [matMenuTriggerFor]="notificationsMenu"
        aria-label="Notifications"
      >
        <mat-icon>notifications</mat-icon>
      </span>

      <!-- Profil utilisateur -->
      <ng-container *ngIf="profileImageUrl; else initialsTpl">
        <img
          [src]="profileImageUrl"
          class="profile-img-small action-icon"
          [matMenuTriggerFor]="profileMenu"
          alt="avatar"
        >
      </ng-container>
      <ng-template #initialsTpl>
        <div
          class="profile-circle action-icon"
          [matMenuTriggerFor]="profileMenu"
          aria-label="Menu Profil"
        >
          {{ currentUser?.prenom?.charAt(0) || 'U' }}
          {{ currentUser?.nom?.charAt(0) || 'S' }}
        </div>
      </ng-template>
    </div>
  </mat-toolbar>

  <!-- Contenu principal : menu + zone routée -->
  <div class="main-content" fxLayout="row" fxFlex>

    <!-- Sidebar pliante -->
    <div
      class="side-nav"
      [class.closed]="!sideNavOpen()"
      fxFlex="{{ sideNavOpen() ? '20%' : '0px' }}"
    >
      <mat-nav-list class="main-menu">
        <ng-container *ngFor="let item of menuItems">
          <ng-container *ngIf="item.subMenu; else singleItem">
            <mat-expansion-panel class="menu-panel" hideToggle>
              <mat-expansion-panel-header>
                <mat-panel-title>
                  <mat-icon>{{ item.icon }}</mat-icon>
                  {{ item.label }}
                </mat-panel-title>
              </mat-expansion-panel-header>
              <mat-nav-list>
                <a
                  mat-list-item
                  *ngFor="let sub of item.subMenu"
                  (click)="sub.action()"
                  [class.active]="currentView() === sub.label"
                >
                  <mat-icon matListItemIcon>chevron_right</mat-icon>
                  <span>{{ sub.label }}</span>
                </a>
              </mat-nav-list>
            </mat-expansion-panel>
          </ng-container>
          <ng-template #singleItem>
            <a
              mat-list-item
              (click)="item.action()"
              [class.active]="currentView() === item.label"
            >
              <mat-icon matListItemIcon>{{ item.icon }}</mat-icon>
              <span>{{ item.label }}</span>
            </a>
          </ng-template>
        </ng-container>

        <mat-divider></mat-divider>

        <mat-nav-list class="bottom-menu">
          <a mat-list-item (click)="navigateTo('settings')">
            <mat-icon matListItemIcon>settings</mat-icon>
            <span>Paramètres</span>
          </a>
          <a mat-list-item (click)="logout()">
            <mat-icon matListItemIcon>exit_to_app</mat-icon>
            <span>Se déconnecter</span>
          </a>
        </mat-nav-list>
      </mat-nav-list>
    </div>

    <!-- Zone de contenu routé -->
    <div fxFlex class="content-area">
      <router-outlet></router-outlet>
    </div>
  </div>

  <!-- Menu Notifications -->
  <mat-menu #notificationsMenu="matMenu">
    <ng-container *ngIf="notifications().length; else noNotes">
      <button mat-menu-item *ngFor="let n of notifications()">
        <mat-icon>{{ n.icon }}</mat-icon>
        <div fxLayout="column">
          <span>{{ n.text }}</span>
          <small>{{ n.date | date:'short' }}</small>
        </div>
      </button>
      <mat-divider></mat-divider>
      <button mat-menu-item (click)="logout()">
        <mat-icon>done_all</mat-icon>
        <span>Tout marquer lu</span>
      </button>
    </ng-container>
    <ng-template #noNotes>
      <button mat-menu-item disabled>
        <mat-icon>notifications_off</mat-icon>
        <span>Aucune notification</span>
      </button>
    </ng-template>
  </mat-menu>

  <!-- Menu Profil -->
  <mat-menu #profileMenu="matMenu">
    <button mat-menu-item (click)="navigateTo('settings')">
      <mat-icon>settings</mat-icon>
      <span>Paramètres</span>
    </button>
    <button mat-menu-item (click)="logout()">
      <mat-icon>exit_to_app</mat-icon>
      <span>Se déconnecter</span>
    </button>
  </mat-menu>

</div>
