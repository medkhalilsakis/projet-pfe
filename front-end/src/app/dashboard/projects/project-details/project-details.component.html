<div class="project-detail" fxLayout="column" fxLayoutGap="24px">

  <!-- 1. Overview -->
  <mat-card *ngIf="project" class="card-overview">
    <mat-card-header>
      <mat-card-title>{{ project.name }}</mat-card-title>
      <mat-card-subtitle>
        Par {{ project.user.prenom }} {{ project.user.nom }}
        <span *ngIf="project.type">• {{ project.type }}</span>
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <p class="description">
        {{ expanded ? project.description : shortDesc }}
        <ng-container *ngIf="hasLongDesc">
          <a class="toggle-desc" (click)="toggleExpanded()">
            {{ expanded ? 'Voir moins' : '… Lire la suite' }}
          </a>
        </ng-container>
      </p>

      <p class="meta">
        <strong>Visibilité :</strong> {{ project.visibilite }}<br>
        <strong>Créé le :</strong>
        {{ project.createdAt | date:'longDate' }}<br>
        <strong>Statut :</strong> {{ statusLabel }}
      </p>
    </mat-card-content>
  </mat-card>


  <!-- 2. Invitations -->
  <!-- Bloc Invitations -->
  <mat-card *ngIf="invitedUsers.length" class="card-invitations">
    <mat-card-title>Invitations</mat-card-title>
    <mat-list>
      <mat-list-item *ngFor="let inv of invitedUsers">
        <div class="inv-item" fxLayout="row" fxLayoutAlign="space-between center">
          <!--<span class="inv-name">{{ inv.prenom }} {{ inv.nom }}</span>-->
          <span class="inv-status">{{ inv.status }}</span>
          <button mat-icon-button color="warn"
                  (click)="removeInvite(inv.id)">
            <mat-icon>cancel</mat-icon>
          </button>
        </div>
      </mat-list-item>
    </mat-list>
    <button mat-mini-fab color="primary"
            class="invite-btn"
            (click)="openInviteDialog()">
      <mat-icon>person_add</mat-icon>
    </button>
  </mat-card>


  <!-- 3. Explorer -->
  <!-- Bloc Explorateur de projet -->
<mat-card class="card-explorer">
  <mat-card-title>Explorateur de projet</mat-card-title>
  <mat-card-content>
    <p>Parcourez l’arborescence des fichiers de votre projet.</p>
    <button mat-stroked-button color="primary" (click)="goToExplorer()">
      <mat-icon>folder_open</mat-icon>
      Ouvrir l’explorateur
    </button>
  </mat-card-content>
</mat-card>


  <!-- 4. Chat -->
<mat-card class="card-chat">
  <mat-card-title>Chat du projet</mat-card-title>
  <mat-card-content>
    <app-project-chat [projectId2]="projectId"></app-project-chat>
  </mat-card-content>
</mat-card>


  <!-- 5. Testers -->
  <!-- Bloc Testeurs assignés (visible pour superviseur seulement) -->
<mat-card *ngIf="isSupervisor && testers.length" class="card-testers">
  <mat-card-title>Testeurs assignés</mat-card-title>
  <mat-card-content>
    <mat-list>
      <mat-list-item *ngFor="let t of testers">
        {{ t.testeur.prenom }} {{ t.testeur.nom }}
        <span class="badge">#{{ t.numeroTesteur }}</span>
      </mat-list-item>
    </mat-list>
    <button mat-stroked-button color="primary" (click)="goToDesignation()">
      <mat-icon>group_add</mat-icon>
      Gérer les testeurs
    </button>
  </mat-card-content>
</mat-card>


  <!-- 6. Pause requests -->
<mat-card *ngIf="pauseRequests.length" class="card-pauses">
  <mat-card-title>Demandes de suspension</mat-card-title>
  <mat-card-content>
    <div class="pause-list">
      <details *ngFor="let p of pauseRequests" class="pause-item">
        <summary class="pause-summary">
          {{ p.requesterName || p.requesterId }} — {{ p.status }}
        </summary>
        <div class="pause-details">
          <p><strong>Raison :</strong> {{ p.reason }}</p>
          <p class="pause-date">
            <em>Demandé le {{ p.requestedAt | date:'short' }}</em>
          </p>
        </div>
      </details>
    </div>
  </mat-card-content>
</mat-card>

</div>
